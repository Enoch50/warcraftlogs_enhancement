var attributes=["critSpell","hasteSpell","mastery","versatilityDamageDone"],columnNames=["Crit","Haste","Mastery","Versatility"],regex=/\/reports\/([\S\s]+?)#fight=([0-9]+)/,PlayerList=new Array;function initialize(){for(var t=0;t<attributes.length;t++)$('<th class="sorting ui-state-default">'+columnNames[t]+"</th>").insertBefore("th.zmdi.zmdi-flag.sorting.ui-state-default");for(t=0;t<attributes.length;t++)$('<td class="attr-'+attributes[t]+'"></td>').insertBefore("td.zmdi.zmdi-flag");$("td.main-table-name").parent().each(function(){var t=new Object;t.rowID=$(this).attr("id"),t.name=$(this).find(".players-table-name .main-table-player").text();var a=$(this).find(".players-table-name .main-table-player").attr("href");if(void 0!==a)try{t.logID=a.match(regex)[1],t.fightID=a.match(regex)[2],PlayerList.push(t)}catch(t){console.log(t)}})}function loadFights(t){$.ajax({type:"GET",url:"https://www.warcraftlogs.com/reports/fights-and-participants/"+PlayerList[t].logID+"/0",dataType:"json",success:function(a){callback_fights(a,t)}})}function loadStats(t,a,s,e,i){$.ajax({type:"GET",url:"https://www.warcraftlogs.com/reports/summary/"+a+"/"+s+"/"+e+"/"+(e+3e3)+"/"+i+"/0/Any/0/-1.0.-1/0",success:function(r){callback_stats(r,t,a,s,e,i)}})}function callback_stats(t,a,s,e,i,r){t={critSpell:(t=(t=(t=t.split("</tbody>")[0]).split("<tbody>")[1]).split('<tr class="composition-row"><td class="composition-label">')[1]).split("Crit: <span class=estimate>")[1].split("</span></span></span>")[0],hasteSpell:t.split("Haste: <span class=estimate>")[1].split("</span></span></span>")[0],mastery:t.split("Mastery: <span class=estimate>")[1].split("</span></span></span>")[0],versatilityDamageDone:t.split("Versatility: <span class=estimate>")[1].split("</span></span></span>")[0]};for(var l in attributes)try{$("#"+a+" .attr-"+attributes[l]).html(t[attributes[l]])}catch(s){console.error(s),console.error(a),console.error(t)}}function callback_fights(t,a){for(var s in PlayerList[a].fight=t,PlayerList[a].fight.friendlies)if(PlayerList[a].fight.friendlies[s].name==PlayerList[a].name){PlayerList[a].sourceID=PlayerList[a].fight.friendlies[s].id;break}for(var s in PlayerList[a].fight.fights)if(PlayerList[a].fight.fights[s].id==PlayerList[a].fightID){PlayerList[a].timestamp=PlayerList[a].fight.fights[s].start_time;break}loadStats(PlayerList[a].rowID,PlayerList[a].logID,PlayerList[a].fightID,PlayerList[a].timestamp,PlayerList[a].sourceID),++a>=PlayerList.length?console.log(PlayerList):loadFights(a)}function loadAttributes(){initialize(),loadFights(0)}function delayLoadAttributes(){0===$(".ranking-table tr:eq(1)").length?(console.log("delay"),setTimeout(delayLoadAttributes,1e3)):loadAttributes()}delayLoadAttributes();